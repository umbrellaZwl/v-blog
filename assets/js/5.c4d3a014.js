(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{353:function(e,t,r){e.exports=r.p+"assets/img/1.5ef5de09.png"},354:function(e,t,r){e.exports=r.p+"assets/img/2.f533293c.png"},370:function(e,t,r){"use strict";r.r(t);var v=r(42),a=Object(v.a)({},(function(){var e=this,t=e.$createElement,v=e._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"小程序错误监控"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#小程序错误监控"}},[e._v("#")]),e._v(" 小程序错误监控")]),e._v(" "),v("h2",{attrs:{id:"js错误"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#js错误"}},[e._v("#")]),e._v(" JS错误")]),e._v(" "),v("p",[e._v("通过"),v("code",[e._v("App")]),e._v("的"),v("code",[e._v("onError")]),e._v("属性监听全局JS错误。")]),e._v(" "),v("h4",{attrs:{id:"onerror-string-error"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#onerror-string-error"}},[e._v("#")]),e._v(" onError(String error)")]),e._v(" "),v("p",[e._v("小程序发生脚本错误或 API 调用报错时触发。也可以使用 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onError.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onError"),v("OutboundLink")],1),e._v(" 绑定监听。")]),e._v(" "),v("p",[v("strong",[e._v("参数")]),e._v("：与 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onError.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onError"),v("OutboundLink")],1),e._v(" 一致")]),e._v(" "),v("ul",[v("li",[e._v("和web端window.onError不一样的地方")])]),e._v(" "),v("table",[v("thead",[v("tr",[v("th"),e._v(" "),v("th",[e._v("window.onError")]),e._v(" "),v("th",[e._v("App({onError})")])])]),e._v(" "),v("tbody",[v("tr",[v("td",[e._v("回调的形参err")]),e._v(" "),v("td",[e._v("形参是一个Error实例")]),e._v(" "),v("td",[e._v("形参是e.stack字符串。例如：string MiniProgramErrorthis.hah is not a functionTypeError: this.hah is not a function   at ge.clickJsBtn (http://127.0.0.1:25208/appservice/pages/sdk/sdk.js:11:10)   at Object.n.safeCallback (http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/WAService.js:2:3057410)   at http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/WAService.js:2:3228407   at a (http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/WAService.js:2:3155482)   at http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/WAService.js:2:3228338   at n (http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/WAService.js:2:3134502)   at http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/WAService.js:2:3135079   at http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/WAService.js:2:1974236   at i (http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/asdebug.js:1:34164)   at c (http://127.0.0.1:25208/appservice/"),v("strong",[e._v("dev")]),e._v("/asdebug.js:1:34275)")])]),e._v(" "),v("tr",[v("td",[e._v("资源错误")]),e._v(" "),v("td",[e._v("能捕获")]),e._v(" "),v("td",[e._v("无法捕获")])])])]),e._v(" "),v("h2",{attrs:{id:"资源加载错误"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#资源加载错误"}},[e._v("#")]),e._v(" 资源加载错误")]),e._v(" "),v("p",[e._v("如上所述，资源错误无法在js层来进行全局监听。可选方案：")]),e._v(" "),v("ul",[v("li",[e._v("针对"),v("code",[e._v("image")]),e._v("等媒体组件编写增强版的自定义组件，收集信息（会造成组件层级加深，带来性能损耗）")]),e._v(" "),v("li",[e._v("开发者监听"),v("code",[e._v("image")]),e._v("组件"),v("code",[e._v("error")]),e._v("事件，调用API上报.")])]),e._v(" "),v("p",[e._v("错误信息如图：")]),e._v(" "),v("p",[v("img",{attrs:{src:r(353),alt:"img"}})]),e._v(" "),v("h2",{attrs:{id:"未处理的rejected态的promise"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#未处理的rejected态的promise"}},[e._v("#")]),e._v(" 未处理的rejected态的promise")]),e._v(" "),v("p",[e._v("通过"),v("code",[e._v("App")]),e._v("的"),v("code",[e._v("onUnhandledRejection")]),e._v("监听")]),e._v(" "),v("h4",{attrs:{id:"onunhandledrejection-object-object"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#onunhandledrejection-object-object"}},[e._v("#")]),e._v(" onUnhandledRejection(Object object)")]),e._v(" "),v("p",[e._v("基础库 2.10.0 开始支持，低版本需做"),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("兼容处理"),v("OutboundLink")],1),e._v("。")]),e._v(" "),v("p",[e._v("小程序有未处理的 Promise 拒绝时触发。也可以使用 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onUnhandledRejection"),v("OutboundLink")],1),e._v(" 绑定监听。注意事项请参考 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onUnhandledRejection"),v("OutboundLink")],1),e._v("。")]),e._v(" "),v("p",[v("strong",[e._v("参数")]),e._v("：与 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onUnhandledRejection"),v("OutboundLink")],1),e._v(" 一致")]),e._v(" "),v("p",[e._v("形参是一个包含reason和promise的对象。如图：")]),e._v(" "),v("p",[v("img",{attrs:{src:r(354),alt:"img"}})]),e._v(" "),v("h2",{attrs:{id:"监听打开的页面不存在"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#监听打开的页面不存在"}},[e._v("#")]),e._v(" 监听打开的页面不存在")]),e._v(" "),v("h4",{attrs:{id:"onpagenotfound-object-object"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#onpagenotfound-object-object"}},[e._v("#")]),e._v(" onPageNotFound(Object object)")]),e._v(" "),v("p",[e._v("基础库 1.9.90 开始支持，低版本需做"),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("兼容处理"),v("OutboundLink")],1),e._v("。")]),e._v(" "),v("p",[e._v("小程序要打开的页面不存在时触发。也可以使用 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onPageNotFound"),v("OutboundLink")],1),e._v(" 绑定监听。注意事项请参考 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onPageNotFound"),v("OutboundLink")],1),e._v("。")]),e._v(" "),v("p",[v("strong",[e._v("参数")]),e._v("：与 "),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("wx.onPageNotFound"),v("OutboundLink")],1),e._v(" 一致")]),e._v(" "),v("p",[v("strong",[e._v("注意：")])]),e._v(" "),v("p",[v("strong",[e._v("1、该回调只能监听本次启动的入口页不存在的场景。对于wx.navigateTo等路由跳转的页面无法监听")])]),e._v(" "),v("p",[v("strong",[e._v("2、")]),v("code",[e._v("且调用wx``.``navigateTo``()")]),e._v("打开一个不存在的页面，会被navigateTo回调监听，如果"),v("code",[e._v("success")]),e._v("和"),v("code",[e._v("fail")]),e._v("回调都没有设置，则会被"),v("code",[e._v("App({onUnhandledRejection})")]),e._v("监听到")]),e._v(" "),v("h3",{attrs:{id:"组件事件信息"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#组件事件信息"}},[e._v("#")]),e._v(" 组件事件信息")]),e._v(" "),v("p",[e._v("由于小程序和web端本身属于两种不同的体系和容器，小程序基于解析特有的文件组织结构和组件系统来开发，没有DOM和BOM，在事件系统上差异比较大的")]),e._v(" "),v("table",[v("thead",[v("tr",[v("th"),e._v(" "),v("th",[e._v("web端")]),e._v(" "),v("th",[e._v("小程序端")])])]),e._v(" "),v("tbody",[v("tr",[v("td",[e._v("事件流")]),e._v(" "),v("td",[e._v("统一的捕获->自身->冒泡")]),e._v(" "),v("td",[e._v("事件发生在组件上，分冒泡事件和非冒泡事件。基础库1.5.0后触摸类事件支持捕获阶段"),v("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#%E4%BA%8B%E4%BB%B6%E8%AF%A6%E8%A7%A3"),v("OutboundLink")],1)])]),e._v(" "),v("tr",[v("td",[e._v("能否全局监听")]),e._v(" "),v("td",[e._v("通过window.addEventListener在捕获阶段监听")]),e._v(" "),v("td",[e._v("只能在组件上绑定，无法全局监听")])]),e._v(" "),v("tr",[v("td"),e._v(" "),v("td"),e._v(" "),v("td")])])]),e._v(" "),v("ul",[v("li",[e._v("方案一：开发者自行在页面的"),v("code",[e._v("wxml")]),e._v("的最外层容器view绑定捕获事件，并调用sdk的api手动发送")]),e._v(" "),v("li",[e._v("方案二：开发一个自定义组件，用于包裹页面"),v("code",[e._v("wxml")])])]),e._v(" "),v("h2",{attrs:{id:"路由切换信息"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#路由切换信息"}},[e._v("#")]),e._v(" 路由切换信息")]),e._v(" "),v("ul",[v("li",[e._v("通过改写"),v("code",[e._v("wx")]),e._v("的路由方法来收集信息https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.switchTab.html")])]),e._v(" "),v("p",[e._v("同时可以在跳转时当前页面url（来源）和跳转url（目标）")]),e._v(" "),v("ul",[v("li",[v("p",[e._v("包括以下方法：")])]),e._v(" "),v("li",[v("ul",[v("li",[e._v("wx.switchTab")]),e._v(" "),v("li",[e._v("wx.reLaunch")]),e._v(" "),v("li",[e._v("wx.redirectTo")]),e._v(" "),v("li",[e._v("wx.navigateTo")]),e._v(" "),v("li",[e._v("wx.navigateBack")])])])]),e._v(" "),v("p",[e._v("微信下面的这些方法是readonly的 无法修改")]),e._v(" "),v("h2",{attrs:{id:"用户分析"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#用户分析"}},[e._v("#")]),e._v(" 用户分析")]),e._v(" "),v("ul",[v("li",[e._v("通过对"),v("code",[e._v("App")]),e._v("和"),v("code",[e._v("Page")]),e._v("的入参进行包裹后提供包裹后的结果或通过覆盖"),v("code",[e._v("App")]),e._v("和"),v("code",[e._v("Page")]),e._v("全局变量来监听onShow，onLoad，onShareMessage等生命周期函数，来收集pv,uv信息。")]),e._v(" "),v("li",[e._v("同时也需要提供自定义的上报方法调用")])]),e._v(" "),v("h2",{attrs:{id:"console信息"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#console信息"}},[e._v("#")]),e._v(" console信息")]),e._v(" "),v("table",[v("thead",[v("tr",[v("th",[e._v("web端")]),e._v(" "),v("th",[e._v("小程序")])])]),e._v(" "),v("tbody",[v("tr",[v("td",[e._v("console作为window的一个属性挂在window下")]),e._v(" "),v("td",[e._v("小程序环境内的全局变量")])]),e._v(" "),v("tr",[v("td"),e._v(" "),v("td")])])]),e._v(" "),v("ul",[v("li",[e._v("可通过覆盖全局console来收集信息。要注意的是覆盖的是全局变量"),v("code",[e._v("console")]),e._v("不是"),v("code",[e._v("wx.console")])]),e._v(" "),v("li",[e._v("提供增强版的console")])]),e._v(" "),v("h2",{attrs:{id:"接口错误"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#接口错误"}},[e._v("#")]),e._v(" 接口错误")]),e._v(" "),v("p",[e._v("通过重写wx.request、wx.downloadFile来收集信息")]),e._v(" "),v("p",[e._v("wx.request和wx.downloadFile等方法是readonly的")]),e._v(" "),v("h2",{attrs:{id:"自定义上报"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#自定义上报"}},[e._v("#")]),e._v(" 自定义上报")]),e._v(" "),v("p",[e._v("通过提供sdk常见的一些上报方法进行收集")]),e._v(" "),v("h2",{attrs:{id:"实现方式"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#实现方式"}},[e._v("#")]),e._v(" 实现方式")]),e._v(" "),v("table",[v("thead",[v("tr",[v("th",[e._v("通过监听重写api。"),v("code",[e._v("wx.onPageShow")]),e._v("等方式https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html")]),e._v(" "),v("th",[e._v("通过提供函数接受options对象返回新的options对象给App和Page调用。参考阿里云ARMShttps://help.aliyun.com/document_detail/103992.html#title-woy-xao-u0c")]),e._v(" "),v("th",[e._v("通过覆盖"),v("code",[e._v("App")]),e._v(", "),v("code",[e._v("Page")]),e._v("等全局变量参考百度移动统计https://mtj.baidu.com/web/overview?appId=3017112")])])]),e._v(" "),v("tbody",[v("tr",[v("td",[e._v("只能监听应用级事件")]),e._v(" "),v("td",[e._v("灵活，但需要开发者手动写一些代码，且不能适配taro等框架（因为框架层都是基于组件开发，然后在编译阶段调用App传入options对象）")]),e._v(" "),v("td",[e._v("引入即可上报，无需用户额外添加逻辑。且理论上可适配任何小程序框架（待测试）缺点：代码需要在App.js中最顶部引入")])])])])])}),[],!1,null,null,null);t.default=a.exports}}]);